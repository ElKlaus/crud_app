<!DOCTYPE html>
<html>

<head>

	<meta charset="utf-8">
	<!-- <base href="/"> -->

	<title>Jquery CRUD Application</title>
	<meta name="description" content="Simple Starter Description">

	<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">

	<!-- <link rel="icon" href="images/favicon.png"> -->
	<meta property="og:image" content="images/preview.jpg">

	<link rel="stylesheet" href="libs/bootstrap/css/bootstrap-reboot.min.css">
	<link rel="stylesheet" href="libs/bootstrap/css/bootstrap-grid.min.css">
	<link rel="stylesheet" href="libs/bootstrap/css/bootstrap.min.css">

	<link rel="stylesheet" href="css/main.css">
	<link rel="stylesheet" href="css/media.css">

	<script src="libs/jquery/jquery-3.6.0.min.js"></script>
	<script src="libs/bootstrap/js/bootstrap.bundle.min.js"></script>

	<script src="js/common.js" defer></script>

</head>

<body>
	<div class="container my-3">
		<h1 class="text-center">Jquery CRUD Application</h1>

		<!-- Button trigger modal -->
		<button type="button" class="btn btn-dark my-3" data-bs-toggle="modal" data-bs-target="#completeModal">
			Add new user
		</button>

		<div id="displayDataTable"></div>
	</div>




	<!-- Modal -->
	<div class="modal fade" id="completeModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="exampleModalLabel">New user</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<div class="modal-body">
					<div class="mb-3">
						<label for="completename" class="form-label">Name</label>
						<input type="text" class="form-control" id="completename" placeholder="Enter your name">
					</div>
					<div class="mb-3">
						<label for="completeemail" class="form-label">Email</label>
						<input type="text" class="form-control" id="completeemail" placeholder="Enter your email">
					</div>
					<div class="mb-3">
						<label for="completemobile" class="form-label">Mobile</label>
						<input type="text" class="form-control" id="completemobile" placeholder="Enter your mobile number">
					</div>
					<div class="mb-3">
						<label for="completeplace" class="form-label">Place</label>
						<input type="text" class="form-control" id="completeplace" placeholder="Enter your place">
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-dark" onclick="addUser()">Submit</button>
					<button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
				</div>
			</div>
		</div>
	</div>

	<!-- Modal update -->
	<div class="modal fade" id="updateModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="exampleModalLabel">Update details</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<div class="modal-body">
					<div class="mb-3">
						<label for="updatename" class="form-label">Name</label>
						<input type="text" class="form-control" id="updatename" placeholder="Enter your name">
					</div>
					<div class="mb-3">
						<label for="updateemail" class="form-label">Email</label>
						<input type="text" class="form-control" id="updateemail" placeholder="Enter your email">
					</div>
					<div class="mb-3">
						<label for="updatemobile" class="form-label">Mobile</label>
						<input type="text" class="form-control" id="updatemobile" placeholder="Enter your mobile number">
					</div>
					<div class="mb-3">
						<label for="updateplace" class="form-label">Place</label>
						<input type="text" class="form-control" id="updateplace" placeholder="Enter your place">
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-dark" onclick="updateDetails()">Update</button>
					<button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
					<input type="hidden" id="hiddendata">
				</div>
			</div>
		</div>
	</div>

	<script>
		$(document).ready(function() {
			displayData();
		});

		// Display function
		const displayData = function() {
			const displayData = "true"; //Поправить

			$.ajax({
				url: "display.php",
				type: "post",
				data: {
					displaySend: displayData
				},
				success: function(data, status) {
					$('#displayDataTable').html(data);
				}
			});
		};

		// Add user
		const addUser = function () {
			const nameAdd   = $('#completename').val(),
						emailAdd  = $('#completeemail').val(),
			 			mobileAdd = $('#completemobile').val(),
			 			placeAdd  = $('#completeplace').val();

			$.ajax({
				url: "insert.php",
				type: "post",
				data: {
					nameSend: nameAdd,
					emailSend: emailAdd,
					mobileSend: mobileAdd,
					placeSend: placeAdd
				},
				success: function(data, status) {
					$('#completeModal').modal('hide');

					displayData();
				}
			});
		};

		// Delete record
		const deleteUser = function(deleteId) {
			$.ajax({
				url: "delete.php",
				type: "post",
				data: {
					deleteSend: deleteId,
				},
				success: function(data, status) {
					displayData();

				}
			});
		};

		// Update function
		const getDetails = function(updateId) {
			$('#hiddendata').val(updateId);

			$.post("update.php", {updateId: updateId}, function(data, status){
				const userId = JSON.parse(data);

				$('#updatename').val(userId.name);
				$('#updateemail').val(userId.email);
				$('#updatemobile').val(userId.mobile);
				$('#updateplace').val(userId.place);
			});

			$('#updateModal').modal("show");
		};

		// oncklick update event function
		const updateDetails = function() {
			const updateName   = $('#updatename').val(),
						updateEmail  = $('#updateemail').val(),
						updateMobile = $('#updatemobile').val(),
						updatePlace  = $('#updateplace').val(),
						hiddenData	 = $('#hiddendata').val();

			$.post("update.php", {
				updateName: updateName,
				updateEmail: updateEmail,
				updateMobile: updateMobile,
				updatePlace: updatePlace,
				hiddenData: hiddenData,
			}, function(data, status) {
				$('#updateModal').modal('hide');

				displayData();
			});
		};

	</script>
</body>
</html>